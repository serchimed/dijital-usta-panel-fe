<!DOCTYPE html>
<html lang="tr">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Adayların Puanlarını Güncelle | Dijital Usta</title>
  <link rel="stylesheet" href="./s/site.css" />
<link rel="icon" type="image/x-icon" href="./s/favicon.ico" />
</head>

<body>
  <header>
    <a href="./"><img src="./s/logo.png" alt="Dijital Usta" /></a>
    <button aria-label="Menü"><i></i><i></i><i></i></button>
  </header>
  <nav><ul></ul></nav>
  <main>
    <h2>Adayların Puanlarını Güncelle</h2>

    <label for="pointType">
      Puan Türü
      <select id="pointType">
        <option value="A">Puan A</option>
        <option value="Tobb">Puan TOBB ETÜ</option>
      </select>
    </label>

    <label for="eposta">Adayların E-posta Adresleri ve Puanları
      <br />
      (Her satıra bir aday gelecek şekilde yazınız. Örnek: aday@gmail.com,85)
      <textarea id="lines"></textarea>
    </label>

    <button>Kaydet</button>
    <p></p>

  </main>
  <footer>
    <div>
      <span>
        <h1>Dijital Usta</h1>
        <p>Gençleri e-ticaretle buluşturup<br/>KOBİ'lere yetkin iş gücü kazandırmayı amaçlar.</p>
      </span>
      <img src="./s/logo-3.png" alt="Dijital Usta'nın Destekçileri" />
    </div>
    <div>
      © 2025 Dijital Usta | Tüm Haklar Saklıdır.
      <a href="concent.html">KVKK Aydınlatma Metni ve Açık Rıza Formu</a>
    </div>
  </footer>
  <script src="./s/site.js"></script>
  <script>
    onAuthReady(() => {
      let $btn = document.querySelector("main button");
      let $msg = $btn.nextElementSibling;
      $btn.addEventListener(CLICK_EVENT, async function () {
        let req = {
          lines: val("lines"),
          pointType: val("pointType")
        };

        req.lines = (req.lines || "").trim();

        if (!req.lines) {
          $msg.innerHTML = "• E-posta adreslerini ve puanlarını giriniz.";
          return;
        }

        let rows = req.lines.split(/\r?\n/).map(l => l.trim()).filter(Boolean);
        let errs = [];
        let normalized = [];

        rows.forEach((line, idx) => {
          let i = idx + 1;
          let parts = line.split(",").map(s => s.trim());

          if (parts.length !== 2) {
            errs.push(`Satır ${i}: "eposta,puan" biçiminde olmalıdır.`);
            return;
          }

          let email = parts[0];
          let scoreStr = parts[1];
          let score = Number(scoreStr);

          if (!checkEmail(email)) {
            errs.push(`Satır ${i}: Geçersiz e-posta (${email}).`);
          }
          if (!Number.isFinite(score) || score < 0 || score > 100) {
            errs.push(`Satır ${i}: Puan 0-100 arasında olmalıdır (${scoreStr}).`);
          }

          normalized.push(`${email},${scoreStr}`);
        });

        if (errs.length) {
          $msg.textContent = errs.map(e => `• ${e}`).join("\n");
          return;
        }

        req.lines = normalized.join("\n");
        $msg.textContent = "";

        await apiBtn(
          this,
          "CandidatePoint/Add",
          req,
          "Puanlar eklendi.",
          ERROR_MESSAGE_DEFAULT,
          "admin-candidate-list.html"
        );
      });
    });
  </script>
</body>

</html>
